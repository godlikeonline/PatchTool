
<!-- This could be called the suite-first versus application-first
     organization.  For my money, application-first wins.

     Can we generalize it to say bigger-first sucks, and smaller-first rules?
     How will this work with the files themselves?  I originally grouped them
     into massive source and destination configs.  Now I'm thinking they need
     to be grouped at the individual levels - in other words, push the
     responsibility down the stack as far as possible.

     Maybe I can treat the files or components like objects of some class.
     They contain all the information they need to DO SOMETHING USEFUL.  The
     way I see it being used is ...
     -->

<!-- SQL is only used in-house, for producing patches.  The patches themselves
     will still be self-contained. -->

<product_suites>
    <suite version="9.10">
        <!-- <application name="ADIT" installer="adit_installer" /> -->
        <application name="AGMS" installer="agms_installer" />
        <application name="Centricity" installer="centricity_installer" />
        <application name="ChannelManager" installer="server_installer" />
        <application name="ContactSourceRunner" installer="server_installer" />
        <application name="DADI" installer="dadi_installer" />
        <application name="DBMigration" installer="dbmigration_installer" />
        <application name="EvaluationConsistencyCheck" installer="ecc_installer" />
        <application name="Server" installer="server_installer" />
        <application name="WebApps" installer="webapps_installer" />
        <application name="WMWrapperService" installer="wmwrapperservice_installer" />
    </suite>
    <suite version="10.0">
        <!-- <application name="ADIT" installer="adit_installer" /> -->
        <application name="AGMS" installer="agms_installer" />
        <application name="Centricity" installer="centricity_installer" />
        <application name="ChannelManager" installer="server_installer" />
        <application name="ContactSourceRunner" installer="server_installer" />
        <application name="DADI" installer="dadi_installer" />
        <application name="DBMigration" installer="dbmigration_installer" />
        <application name="EvaluationConsistencyCheck" installer="ecc_installer" />
        <application name="Server" installer="server_installer" />
        <application name="WebApps" installer="webapps_installer" />
        <application name="WMWrapperService" installer="wmwrapperservice_installer" />
    </suite>
    <suite version="10.1">
        <!-- <application name="ADIT" installer="adit_installer" /> -->
        <application name="AGMS" installer="tools_installer" />
        <application name="Centricity" installer="centricity_installer" />
        <application name="ChannelManager" installer="server_installer" />
        <application name="ContactSourceRunner" installer="server_installer" />
        <application name="DADI" installer="tools_installer" />
        <application name="DBMigration" installer="tools_installer" />
        <application name="EvaluationConsistencyCheck" installer="tools_installer" />
        <application name="Server" installer="server_installer" />
        <application name="WebApps" installer="webapps_installer" />
        <application name="WMWrapperService" installer="wmwrapperservice_installer" />
    </suite>
</product_suites>

<applications>
    <!-- When we add Curie (11.0 or 10.5) to maintenance, we may want to add EnoderSvc, SearchServer and ESMS applications -->
    <!-- Also, ChannelManager and Centricity are back in the server_installer for Curie -->
    <application name="AGMS">
        <version name="9.10" installer="agms_installer" />
        <version name="10.0" installer="agms_installer" />
        <version name="10.1" installer="tools_installer" />
    </application>

    <application name="Centricity">
        <version name="9.10" installer="centricity_installer" />
        <version name="10.0" installer="centricity_installer" />
        <version name="10.1" installer="centricity_installer" />
    </application>

    <application name="ChannelManager">
        <version name="9.10" installer="server_installer" />
        <version name="10.0" installer="channelmanager_installer" />
        <version name="10.1" installer="channelmanager_installer" />
    </application>

    <application name="ContactSourceRunner">
        <version name="9.10" installer="server_installer" />
        <version name="10.0" installer="server_installer" />
        <version name="10.1" installer="server_installer" />
    </application>

    <application name="DADI">
        <version name="9.10" installer="dadi_installer" />
        <version name="10.0" installer="dadi_installer" />
        <version name="10.1" installer="dadi_installer" />
    </application>

    <application name="DBMigration">
        <version name="9.10" installer="dbmigration_installer" />
        <version name="10.0" installer="dbmigration_installer" />
        <version name="10.1" installer="tools_installer" />
    </application>

    <application name="EvaluationConsistencyCheck">
        <version name="9.10" installer="ecc_installer" />
        <version name="10.0" installer="ecc_installer" />
        <version name="10.1" installer="tools_installer" />
    </application>

    <!-- reference to application Server below: missing referential integrity -->
    <application name="Server">
        <version name="9.10" installer="server_installer" />
        <version name="10.0" installer="server_installer" />
        <version name="10.1" installer="server_installer" />
    </application>

    <application name="WebApps">
        <version name="9.10" installer="webapps_installer" />
        <version name="10.0" installer="webapps_installer" />
        <version name="10.1" installer="webapps_installer" />
    </application>

    <application name="WMWrapperService">
        <version name="9.10" installer="wmwrapperservice_installer" />
        <version name="10.0" installer="wmwrapperservice_installer" />
        <version name="10.1" installer="wmwrapperservice_installer" />
    </application>
</applications>


@@@@@@@


<!-- application-first versus component-first (component-first wins?) -->

<!-- application-first -->
  <patch version="10.1.14">
      <application name="Server">
          <component name="PATCH-114">
              <!-- run batch scripts or whatever before updating files -->
              <pre action="" />
              <files action="add">
                  <file source="" target="" />
                  <file source="" target="" />
              </files>
              <files action="remove">
                  <file target="" />
              </files>
              <!-- run batch scripts or whatever after updating files -->
              <post action="" />
          </component>
      </application>

      <application name="ChannelManager">
          <component name="PATCH-114">
              <!-- run batch scripts or whatever before updating files -->
              <pre action="" />
              <files action="add">
                  <file source="" target="" />
                  <file source="" target="" />
              </files>
              <files action="remove">
                  <file target="" />
              </files>
              <!-- run batch scripts or whatever after updating files -->
              <post action="" />
          </component>
      </application>

      <application name="Centricity">
          <component name="PATCH-78">
              <!-- run batch scripts or whatever before updating files -->
              <pre action="" />
              <files action="add">
                  <file source="" target="" />
                  <file source="" target="" />
              </files>
              <files action="remove">
                  <file target="" />
              </files>
              <!-- run batch scripts or whatever after updating files -->
              <post action="" />
          </component>
      </application>
  </patch>


<!-- component-first: maybe better if one patch updates multiple applications -->
<patch version="10.1.14">
    <component name="PATCH-114">
        <application name="Server">
            <!-- run batch scripts or whatever before updating files -->
            <pre action="" />
            <!-- add or replace -->
            <files default_action="add">
                <!--
                    table:
                        branches
                    fields:
                        branch_id int (PK?)
                        repository_root text            // svn://svn.click2coach.net/EPS
                        repository_path text            // $repository_root + /bla/bla/bla
                        friendly_name text allow_nulls  // 10.1dev

                    table:
                        build
                    fields:
                        build_id int (PK?)
                        branch_id int (FK into branches.branch_id)
                        build_date date allow_nulls
                        build_machine text allow_nulls  // (host?)
                        build_version text (M.m.R)      // marketing
                        build_number int
                        wc_root text allow_nulls        // OS path
                        checked_out_revision int allow_nulls    // build_revision or whatever

                    table:
                        binaries                        // manually curated
                    fields:
                        binary_id int (PK?)
                        name text allow_nulls           // e.g., ChanMgrSvc.exe
                        build_path text                 // SOME_ROOT/workdir/ChannelManager/

                    table:
                        binary_instances                // automatically generated
                    fields:
                        // Composite PK of binary_id + build_id?  Seems
                        // needlessly complex.
                        binary_id int (FK into binaries.binary_id)
                        build_id int (FK into build.build_id)
                        md5sum text
                        binary_version text (M.m.R.b)    // explorer file version



                -->
                <file target_exists="prompt"
                    source=@"${srcRoot}\workdir\ChannelManager\SIPChannel.dll"
                    target=@"${cmRoot}\SIPChannel.dll" />
                <file target_exists="overwrite"
                    source=@"${srcRoot}\workdir\ChannelManager\SIPChannel.pdb"
                    target=@"${cmRoot}\SIPChannel.pdb" />
                <file target_exists="pass"
                    source=@"${srcRoot}\workdir\ChannelManager\SIPWrapperLib.dll"
                    target=@"${cmRoot}\SIPWrapperLib.dll" />
                <file target_exists="rename"
                    source=@"${srcRoot}\workdir\ChannelManager\SIPWrapperLib.pdb"
                    target=@"${cmRoot}\SIPWrapperLib.pdb" />
                <file target_exists="overwrite_if_newer"
                    source=@"${srcRoot}\workdir\ChannelManager\SIPConfigLib.dll"
                    target=@"${cmRoot}\SIPConfigLib.dll" />

                <file source=@"${srcRoot}\workdir\ChannelManager\SIPConfigLib.pdb" target=@"${cmRoot}\SIPConfigLib.pdb" />
                <file source=@"${srcRoot}\workdir\ChannelManager\SIPPhone.dll" target=@"${cmRoot}\SIPPhone.dll" />
                <file source=@"${srcRoot}\workdir\ChannelManager\SIPPhone.pdb" target=@"${cmRoot}\SIPPhone.pdb" />
                <file source=@"${srcRoot}\workdir\SharedResources\LumiSoft.Net.dll" target=@"${cmRoot}\LumiSoft.Net.dll" />
                <file source=@"${srcRoot}\workdir\SharedResources\LumiSoft.Net.pdb" target=@"${cmRoot}\LumiSoft.Net.pdb" />
                <file source=@"${srcRoot}\workdir\SharedResources\AlvasAudio.dll" target=@"${serverRoot}\AlvasAudio.dll" />
                <file source=@"${srcRoot}\workdir\SharedResources\AlvasAudio.pdb" target=@"${serverRoot}\AlvasAudio.pdb" />
                <file source=@"${srcRoot}\workdir\ChannelManager\AudioReader.dll" target=@"${cmRoot}\AudioReader.dll" />
                <file source=@"${srcRoot}\workdir\ChannelManager\AudioReader.pdb" target=@"${cmRoot}\AudioReader.pdb" />
                <file source=@"${srcRoot}\workdir\SharedResources\server.dll" target=@"${cmRoot}\server.dll" />
                <file source=@"${srcRoot}\workdir\SharedResources\server.pdb" target=@"${cmRoot}\server.pdb" />
                <file source=@"${srcRoot}\workdir\SharedResources\log4net.dll" target=@"${cmRoot}\log4net.dll" />
                <file source=@"${srcRoot}\config\chanmgr\ChanMgrSvc.SIP.config" target=@"${cmRoot}\ChanMgrSvc.SIP.config" />
            </files>
            <files action="remove">
                <file target=@"${cmRoot}\SIPGateway\InstallUtil.exe" />
                <file target=@"${cmRoot}\SIPGateway\LumiSoft.Net.dll" />
                <file target=@"${cmRoot}\SIPGateway\LumiSoft.Net.pdb" />
                <file target=@"${cmRoot}\SIPGateway\LumiSoft.Net.xml" />
                <file target=@"${cmRoot}\SIPGateway\log4net.dll" />
                <file target=@"${cmRoot}\SIPGateway\sc.exe" />
                <file target=@"${cmRoot}\SIPGateway\server.dll" />
                <file target=@"${cmRoot}\SIPGateway\server.pdb" />
           </files>
            <!-- run batch scripts or whatever after updating files -->
            <post action="" />
        </application>

        <application name="ChannelManager">
            <!-- run batch scripts or whatever before updating files -->
            <pre action="" />
            <files action="add">
                <file source="" target="" />
                <file source="" target="" />
            </files>
            <files action="remove">
                <file target="" />
            </files>
            <!-- run batch scripts or whatever after updating files -->
            <post action="" />
        </application>
    </component>

    <component name="PATCH-78">
        <application name="Centricity">
            <!-- run batch scripts or whatever before installing the files -->
            <pre action="" />
            <files action="add">
                <file source="" target="" />
                <file source="" target="" />
            </files>
            <files action="remove">
                <file target="" />
            </files>
            <!-- run batch scripts or whatever after updating files -->
            <post action="" />
        </component>
    </application>
</patch>

